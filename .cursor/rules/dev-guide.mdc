---
description: 
globs: 
alwaysApply: false
---
# EchoLab å¼€å‘æŒ‡å—

## ç±»å‹å®šä¹‰ç®¡ç†è§„åˆ™

### æ ¸å¿ƒåŸåˆ™ï¼šç»Ÿä¸€ç±»å‹å®šä¹‰
**é‡è¦ï¼šæ‰€æœ‰ Electron API çš„ç±»å‹å®šä¹‰å¿…é¡»ç»Ÿä¸€åœ¨ `src/preload/index.d.ts` ä¸­ç®¡ç†ã€‚**

### ç±»å‹å®šä¹‰å±‚æ¬¡ç»“æ„

1. **ä¸»è¦ç±»å‹å®šä¹‰æ–‡ä»¶**
   - `src/preload/index.d.ts` - **å”¯ä¸€çš„å…¨å±€ API ç±»å‹å®šä¹‰æ–‡ä»¶**
   - `src/types/shared.ts` - ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹å…±äº«çš„ä¸šåŠ¡ç±»å‹

2. **ç¦æ­¢çš„åšæ³•**
   - âŒ ä¸è¦åœ¨ `src/renderer/src/env.d.ts` ä¸­é‡å¤å®šä¹‰ API ç±»å‹
   - âŒ ä¸è¦åœ¨ `src/renderer/src/types/global.d.ts` ä¸­é‡å¤å®šä¹‰ API ç±»å‹  
   - âŒ ä¸è¦åœ¨ä¸šåŠ¡æ–‡ä»¶ä¸­ä½¿ç”¨ `declare global` é‡æ–°å£°æ˜ API ç±»å‹
   - âŒ ä¸è¦åˆ›å»ºå¤šä¸ªå…¨å±€ç±»å‹å®šä¹‰æ–‡ä»¶

### API ç±»å‹å®šä¹‰è§„èŒƒ

å½“éœ€è¦æ·»åŠ æ–°çš„ Electron API æ—¶ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

1. **åœ¨ `src/preload/index.ts` ä¸­å®ç° API**
   ```typescript
   const newAPI = {
     someMethod: (param: string): Promise<Result> => 
       ipcRenderer.invoke('new:some-method', param)
   }
   ```

2. **åœ¨ `src/preload/index.d.ts` ä¸­æ·»åŠ ç±»å‹å®šä¹‰**
   ```typescript
   interface NewAPI {
     someMethod: (param: string) => Promise<Result>
   }
   
   declare global {
     interface Window {
       api: {
         // ... ç°æœ‰ API
         newAPI: NewAPI
       }
     }
   }
   ```

3. **åœ¨ `src/types/shared.ts` ä¸­å®šä¹‰ä¸šåŠ¡ç±»å‹**
   ```typescript
   export interface Result {
     success: boolean
     data?: unknown
     error?: string
   }
   ```

### ç±»å‹å¯¼å…¥è§„èŒƒ

åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ä½¿ç”¨ç±»å‹æ—¶ï¼š

```typescript
// âœ… æ­£ç¡®ï¼šä» shared å¯¼å…¥ä¸šåŠ¡ç±»å‹
import type { RecentPlayItem, StoreSettings } from '@renderer/types'

// âœ… æ­£ç¡®ï¼šå…¨å±€ API ç±»å‹è‡ªåŠ¨å¯ç”¨ï¼Œæ— éœ€å¯¼å…¥
const result = await window.api.store.getRecentPlays()

// âŒ é”™è¯¯ï¼šä¸è¦å¯¼å…¥æˆ–é‡æ–°å£°æ˜å…¨å±€ç±»å‹
import '@renderer/types/global' // å·²åˆ é™¤
```

### æ–‡ä»¶ç»“æ„çº¦å®š

```
src/
â”œâ”€â”€ preload/
â”‚   â”œâ”€â”€ index.ts          # API å®ç°
â”‚   â””â”€â”€ index.d.ts        # ğŸ”‘ å”¯ä¸€çš„å…¨å±€ç±»å‹å®šä¹‰
â”œâ”€â”€ types/
â”‚   â””â”€â”€ shared.ts         # ä¸šåŠ¡ç±»å‹å®šä¹‰
â””â”€â”€ renderer/src/
    â”œâ”€â”€ types/
    â”‚   â””â”€â”€ index.ts      # æ¸²æŸ“è¿›ç¨‹ç‰¹æœ‰ç±»å‹
    â””â”€â”€ hooks/
        â””â”€â”€ useRecentPlays.ts  # ä¸šåŠ¡é€»è¾‘ï¼Œç›´æ¥ä½¿ç”¨å…¨å±€ç±»å‹
```

## ç»„ä»¶å¼€å‘è§„èŒƒ

### 1. ç»„ä»¶å‘½åå’Œç»“æ„
- ä½¿ç”¨ PascalCaseï¼š`VideoPlayer.tsx`
- ç»„ä»¶æ–‡ä»¶åä¸ç»„ä»¶åä¸€è‡´
- æ¯ä¸ªç»„ä»¶ä¸€ä¸ªæ–‡ä»¶ï¼Œå¤æ‚ç»„ä»¶å¯å»ºç«‹æ–‡ä»¶å¤¹

### 2. Hook å¼€å‘è§„èŒƒ
- ä½¿ç”¨ camelCaseï¼Œä»¥ `use` å¼€å¤´ï¼š`useVideoPlayer.ts`
- è¿”å›å¯¹è±¡åŒ…å«çŠ¶æ€å’Œæ“ä½œæ–¹æ³•
- ä½¿ç”¨ TypeScript ä¸¥æ ¼ç±»å‹å®šä¹‰

### 3. é”™è¯¯å¤„ç†è§„èŒƒ
- æ‰€æœ‰å¼‚æ­¥æ“ä½œå¿…é¡»åŒ…å« try-catch
- æä¾›ç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
- è®°å½•è¯¦ç»†çš„æ§åˆ¶å°æ—¥å¿—

## æ€§èƒ½ä¼˜åŒ–æŒ‡å—

### 1. React æ€§èƒ½ä¼˜åŒ–
- åˆç†ä½¿ç”¨ `useMemo` å’Œ `useCallback`
- ä½¿ç”¨ `React.memo` é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
- å¤§æ•°æ®åˆ—è¡¨ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨

### 2. ç±»å‹æ£€æŸ¥ä¼˜åŒ–
- é¿å…ä½¿ç”¨ `any` ç±»å‹
- ä¸ºæ‰€æœ‰ Props å®šä¹‰æ¥å£
- ä½¿ç”¨ä¸¥æ ¼çš„ TypeScript é…ç½®

## ä»£ç è´¨é‡ä¿è¯

### 1. å¼€å‘å·¥å…·é“¾
```bash
pnpm lint        # ESLint æ£€æŸ¥
pnpm format      # Prettier æ ¼å¼åŒ–  
pnpm typecheck   # TypeScript ç±»å‹æ£€æŸ¥
```

### 2. æäº¤å‰æ£€æŸ¥
- è¿è¡Œç±»å‹æ£€æŸ¥ï¼š`pnpm typecheck`
- è¿è¡Œä»£ç æ ¼å¼åŒ–ï¼š`pnpm format`
- ç¡®ä¿æ²¡æœ‰ ESLint é”™è¯¯

## è°ƒè¯•å’Œæµ‹è¯•

### 1. å¼€å‘æ¨¡å¼è°ƒè¯•
- Electron DevTools è‡ªåŠ¨æ‰“å¼€
- React DevTools æ”¯æŒ
- è¯¦ç»†çš„æ§åˆ¶å°æ—¥å¿—

### 2. ç±»å‹å®‰å…¨éªŒè¯
- å®šæœŸè¿è¡Œ `pnpm typecheck:web` å’Œ `pnpm typecheck:node`
- ç¡®ä¿ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ç±»å‹ä¸€è‡´æ€§

## React Hook æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ

### 1. useEffect ä¾èµ–ä¼˜åŒ–

#### é—®é¢˜æè¿°
React ä¸å»ºè®®å°†å‡½æ•°ä½œä¸º useEffect çš„ä¾èµ–ï¼Œå› ä¸ºå‡½æ•°åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šé‡æ–°åˆ›å»ºï¼Œå¯¼è‡´ effect ä¸å¿…è¦åœ°é‡æ–°æ‰§è¡Œã€‚

#### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ useRef å­˜å‚¨å‡½æ•°å¼•ç”¨**
```typescript
// âŒ ä¸å¥½çš„åšæ³• - å‡½æ•°ä½œä¸ºä¾èµ–
useEffect(() => {
  initialize();
}, [restoreVideoState, restoreSubtitles, getRecentPlayByPath]);

// âœ… å¥½çš„åšæ³• - ä½¿ç”¨ ref å­˜å‚¨å‡½æ•°å¼•ç”¨
const restoreVideoStateRef = useRef(restoreVideoState);
const restoreSubtitlesRef = useRef(restoreSubtitles);

// æ›´æ–° ref çš„å€¼
restoreVideoStateRef.current = restoreVideoState;
restoreSubtitlesRef.current = restoreSubtitles;

useEffect(() => {
  const initialize = async () => {
    // ä½¿ç”¨ ref.current è°ƒç”¨å‡½æ•°
    restoreVideoStateRef.current(currentTime, playbackRate, volume);
  };
  initialize();
}, [originalFilePath, videoFile]); // åªä¾èµ–åŸºæœ¬æ•°æ®ç±»å‹
```

**æ–¹æ¡ˆäºŒï¼šå°†å‡½æ•°ç§»åˆ° useEffect å†…éƒ¨**
```typescript
// âœ… æœ€ä½³åšæ³• - å‡½æ•°å®šä¹‰åœ¨ effect å†…éƒ¨
useEffect(() => {
  const detectAndLoadSubtitles = async (videoPath: string) => {
    // å‡½æ•°é€»è¾‘
  };
  
  const initialize = async () => {
    await detectAndLoadSubtitles(originalFilePath);
  };
  
  initialize();
}, [originalFilePath, videoFile]); // æ— å‡½æ•°ä¾èµ–
```

### 2. useCallback ä½¿ç”¨æŒ‡å—

#### ä½•æ—¶ä½¿ç”¨ useCallback

1. **é˜²æ­¢å­ç»„ä»¶ä¸å¿…è¦é‡æ¸²æŸ“**
```typescript
// å­ç»„ä»¶ä½¿ç”¨ React.memo æ—¶
const Child = React.memo(({ onClick }) => {
  return <button onClick={onClick}>Click</button>;
});

function Parent() {
  const handleClick = useCallback(() => {
    console.log('clicked');
  }, []); // ç¨³å®šçš„å‡½æ•°å¼•ç”¨
  
  return <Child onClick={handleClick} />;
}
```

2. **ä½œä¸ºå…¶ä»– Hook çš„ä¾èµ–**
```typescript
const fetchData = useCallback(() => {
  return api.getData(userId);
}, [userId]);

useEffect(() => {
  fetchData();
}, [fetchData]); // å®‰å…¨çš„å‡½æ•°ä¾èµ–
```

3. **ä¼ é€’ç»™è‡ªå®šä¹‰ Hook**
```typescript
const handleSearch = useCallback(() => {
  performSearch(query);
}, [query]);

useDebounce(handleSearch, 500);
```

#### ä½•æ—¶ä¸éœ€è¦ useCallback

1. **å‡½æ•°ä¸ä½œä¸º props ä¼ é€’**
2. **å­ç»„ä»¶æœªä½¿ç”¨ React.memo**
3. **å‡½æ•°ä»…åœ¨ç»„ä»¶å†…éƒ¨ä½¿ç”¨**
4. **å‡½æ•°åˆ›å»ºæˆæœ¬å¾ˆä½**

#### æ€§èƒ½è€ƒè™‘

- useCallback æœ¬èº«æœ‰å†…å­˜å’Œè®¡ç®—æˆæœ¬
- åªåœ¨ç¡®å®éœ€è¦æ—¶ä½¿ç”¨
- ä¼˜å…ˆè€ƒè™‘ä»£ç ç»“æ„é‡æ„è€Œéè¿‡åº¦ä¼˜åŒ–

### 3. ä»£ç é‡æ„åŸåˆ™

#### ä¼˜å…ˆçº§é¡ºåº
1. **é‡æ„ä»£ç ç»“æ„** - å°†å‡½æ•°ç§»åˆ°åˆé€‚ä½ç½®
2. **ä½¿ç”¨ useRef** - å­˜å‚¨å‡½æ•°å¼•ç”¨é¿å…ä¾èµ–
3. **ä½¿ç”¨ useCallback** - æœ€åçš„ä¼˜åŒ–æ‰‹æ®µ

#### å®é™…æ¡ˆä¾‹
åœ¨ `usePlayStateInitializer` Hook ä¸­ï¼š
- åŸå§‹é—®é¢˜ï¼šå¤šä¸ªå‡½æ•°ä½œä¸º useEffect ä¾èµ–
- è§£å†³æ–¹æ¡ˆï¼šç»“åˆä½¿ç”¨ useRef å’Œå‡½æ•°å†…éƒ¨å®šä¹‰
- ç»“æœï¼šä¾èµ–æ•°ç»„åªåŒ…å«åŸºæœ¬æ•°æ®ç±»å‹å’Œç¨³å®šå¼•ç”¨

### 4. ä¾èµ–æ•°ç»„æœ€ä½³å®è·µ

#### ç†æƒ³çš„ä¾èµ–æ•°ç»„
```typescript
useEffect(() => {
  // effect é€»è¾‘
}, [
  // åŸºæœ¬æ•°æ®ç±»å‹
  originalFilePath,    // string
  videoFile,          // string
  subtitles.length,   // number
  isEnabled,          // boolean
  
  // ç¨³å®šå¼•ç”¨
  saveStateRef        // ref å¯¹è±¡
]);
```

#### é¿å…çš„ä¾èµ–ç±»å‹
- å‡½æ•°å¼•ç”¨ï¼ˆé™¤éä½¿ç”¨ useCallback ä¼˜åŒ–ï¼‰
- å¯¹è±¡å¼•ç”¨ï¼ˆé™¤éä½¿ç”¨ useMemo ä¼˜åŒ–ï¼‰
- æ•°ç»„å¼•ç”¨ï¼ˆé™¤éä½¿ç”¨ useMemo ä¼˜åŒ–ï¼‰

### 5. æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•

- [ ] useEffect ä¾èµ–æ•°ç»„ä¸­æ— å‡½æ•°å¼•ç”¨
- [ ] ä½¿ç”¨ useRef å­˜å‚¨å¤–éƒ¨å‡½æ•°å¼•ç”¨
- [ ] è€ƒè™‘å°†å‡½æ•°ç§»åˆ° effect å†…éƒ¨
- [ ] ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨ useCallback
- [ ] å­ç»„ä»¶ä½¿ç”¨ React.memo æ—¶æ‰ä¼˜åŒ– props å‡½æ•°
- [ ] ä¾èµ–æ•°ç»„å°½é‡åŒ…å«åŸºæœ¬æ•°æ®ç±»å‹
- [ ] é¿å…è¿‡åº¦ä¼˜åŒ–ï¼Œä¿æŒä»£ç å¯è¯»æ€§

### 6. è°ƒè¯•æŠ€å·§

#### æ£€æŸ¥ effect æ‰§è¡Œé¢‘ç‡
```typescript
useEffect(() => {
  console.log('Effect executed:', { originalFilePath, videoFile });
  // effect é€»è¾‘
}, [originalFilePath, videoFile]);
```

#### ä½¿ç”¨ React DevTools Profiler
- ç›‘æ§ç»„ä»¶é‡æ¸²æŸ“é¢‘ç‡
- è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ
- éªŒè¯ä¼˜åŒ–æ•ˆæœ

## æ€»ç»“

**å…³é”®è¦ç‚¹ï¼š**
1. ğŸ”‘ **ç»Ÿä¸€ç±»å‹å®šä¹‰**ï¼šæ‰€æœ‰å…¨å±€ API ç±»å‹åªåœ¨ `src/preload/index.d.ts` ä¸­å®šä¹‰
2. ğŸš« **é¿å…é‡å¤**ï¼šä¸è¦åœ¨å¤šä¸ªæ–‡ä»¶ä¸­é‡å¤å®šä¹‰ç›¸åŒçš„ç±»å‹
3. ğŸ“ **æ¸…æ™°åˆ†å±‚**ï¼šå…¨å±€ç±»å‹ vs ä¸šåŠ¡ç±»å‹ vs ç»„ä»¶ç±»å‹
4. ğŸ” **ç±»å‹å®‰å…¨**ï¼šä¸¥æ ¼çš„ TypeScript é…ç½®å’Œå®šæœŸæ£€æŸ¥

éµå¾ªè¿™äº›è§„åˆ™å¯ä»¥ç¡®ä¿ä»£ç åº“çš„ç±»å‹å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

## Modal ç»„ä»¶æ ·å¼è§„èŒƒ

### æ¦‚è¿°
ä¸ºäº†ç¡®ä¿åº”ç”¨ä¸­æ‰€æœ‰ Modal ç»„ä»¶çš„è§†è§‰ä¸€è‡´æ€§å’Œç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬å»ºç«‹äº†ç»Ÿä¸€çš„ Modal æ ·å¼ç³»ç»Ÿã€‚æ‰€æœ‰ Modal ç›¸å…³çš„åŸºç¡€æ ·å¼éƒ½é›†ä¸­åœ¨ `src/renderer/src/styles/antd-theme.css` ä¸­ç®¡ç†ã€‚

### æ ·å¼æ¶æ„

#### 1. åŸºç¡€æ ·å¼ï¼ˆå…¨å±€ï¼‰
æ‰€æœ‰ Modal å…±äº«çš„åŸºç¡€æ ·å¼å®šä¹‰åœ¨ `antd-theme.css` ä¸­ï¼š
- é®ç½©å±‚æ ·å¼ï¼ˆèƒŒæ™¯æ¨¡ç³Šã€é€æ˜åº¦ï¼‰
- å®¹å™¨æ ·å¼ï¼ˆèƒŒæ™¯æ¸å˜ã€è¾¹æ¡†ã€é˜´å½±ã€åœ†è§’ï¼‰
- å¤´éƒ¨æ ·å¼ï¼ˆèƒŒæ™¯ã€è¾¹æ¡†ã€è£…é¥°çº¿ï¼‰
- ä¸»ä½“å’Œåº•éƒ¨æ ·å¼
- å…³é—­æŒ‰é’®æ ·å¼
- æŒ‰é’®ç»Ÿä¸€æ ·å¼ï¼ˆprimaryã€defaultã€dangerousï¼‰

#### 2. å˜ä½“æ ·å¼ï¼ˆä¸»é¢˜åŒ–ï¼‰
é€šè¿‡ CSS ç±»ååŒºåˆ†ä¸åŒç±»å‹çš„ Modalï¼š

```css
/* åˆ é™¤ç¡®è®¤ Modal */
.delete-modal

/* å­—å¹•åŠ è½½ Modal */
.subtitle-modal

/* è½¬æ¢æŒ‡å— Modal */
.conversion-guide-modal

/* è®¾ç½® Modal */
.settings-modal
```

æ¯ç§å˜ä½“éƒ½æœ‰ç‹¬ç‰¹çš„ä¸»é¢˜è‰²å½©ï¼š
- åˆ é™¤ç¡®è®¤ï¼šçº¢è‰²ä¸»é¢˜ (`rgba(255, 77, 79, *)`)
- å­—å¹•åŠ è½½ï¼šè“è‰²ä¸»é¢˜ (`rgba(102, 126, 234, *)`)
- è½¬æ¢æŒ‡å—ï¼šå¤©è“è‰²ä¸»é¢˜ (`rgba(24, 144, 255, *)`)
- è®¾ç½®ï¼šç´«è‰²ä¸»é¢˜ (`rgba(139, 92, 246, *)`)

### ä½¿ç”¨è§„èŒƒ

#### 1. Modal ç»„ä»¶ä½¿ç”¨
```tsx
// âœ… æ­£ç¡®ä½¿ç”¨
<Modal
  title={<div className={styles.modalTitle}>æ ‡é¢˜</div>}
  className="delete-modal" // ä½¿ç”¨ç»Ÿä¸€çš„ç±»å
  // ... å…¶ä»–å±æ€§
>
  <div className={styles.modalContent}>
    {/* å†…å®¹ */}
  </div>
</Modal>

// âŒ é”™è¯¯ä½¿ç”¨
<Modal
  className={styles.customModal} // é¿å…ä½¿ç”¨ç»„ä»¶ç‰¹æœ‰çš„æ ·å¼ç±»
>
```

#### 2. æ ·å¼æ–‡ä»¶ç»„ç»‡
- **å…¨å±€ Modal æ ·å¼**ï¼š`src/renderer/src/styles/antd-theme.css`
- **ç»„ä»¶ç‰¹æœ‰æ ·å¼**ï¼šå„ç»„ä»¶çš„ `.module.css` æ–‡ä»¶ä¸­åªåŒ…å«è¯¥ç»„ä»¶ç‰¹æœ‰çš„æ ·å¼
- **é¿å…é‡å¤**ï¼šä¸è¦åœ¨ç»„ä»¶æ ·å¼æ–‡ä»¶ä¸­é‡å¤å®šä¹‰ Modal åŸºç¡€æ ·å¼

#### 3. ç±»åå‘½åè§„èŒƒ
- ä½¿ç”¨ kebab-case å‘½åï¼š`delete-modal`ã€`subtitle-modal`
- ç±»ååº”è¯¥æè¿° Modal çš„åŠŸèƒ½æˆ–ç”¨é€”
- é¿å…ä½¿ç”¨ç»„ä»¶åä½œä¸ºç±»åå‰ç¼€

### CSS å˜é‡ç³»ç»Ÿ

#### Modal ä¸“ç”¨å˜é‡
```css
:root {
  --modal-bg: linear-gradient(145deg, var(--darker-bg) 0%, rgba(26, 26, 26, 0.95) 100%);
  --modal-border: rgba(102, 126, 234, 0.2);
  --modal-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(102, 126, 234, 0.1);
  --modal-header-bg: rgba(102, 126, 234, 0.05);
  --modal-header-border: rgba(102, 126, 234, 0.2);
  --modal-footer-border: rgba(255, 255, 255, 0.08);
  --modal-close-bg: rgba(255, 255, 255, 0.05);
  --modal-close-hover-bg: rgba(255, 255, 255, 0.1);
}
```

### å“åº”å¼è®¾è®¡

Modal æ ·å¼åŒ…å«å®Œæ•´çš„å“åº”å¼æ”¯æŒï¼š
- ç§»åŠ¨ç«¯é€‚é…ï¼ˆå®½åº¦ã€å†…è¾¹è·è°ƒæ•´ï¼‰
- æŒ‰é’®å°ºå¯¸é€‚é…
- å…³é—­æŒ‰é’®ä½ç½®è°ƒæ•´

### æœ€ä½³å®è·µ

#### 1. æ–°å¢ Modal ç±»å‹
1. åœ¨ `antd-theme.css` ä¸­æ·»åŠ æ–°çš„å˜ä½“æ ·å¼
2. é€‰æ‹©åˆé€‚çš„ä¸»é¢˜è‰²å½©
3. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨å¯¹åº”çš„ç±»å
4. æ›´æ–°æœ¬æ–‡æ¡£

#### 2. è‡ªå®šä¹‰æ ·å¼
- ä¼˜å…ˆä½¿ç”¨ CSS å˜é‡è¿›è¡Œä¸»é¢˜å®šåˆ¶
- ç»„ä»¶ç‰¹æœ‰æ ·å¼æ”¾åœ¨å¯¹åº”çš„ `.module.css` æ–‡ä»¶ä¸­
- é¿å…ä½¿ç”¨ `!important`ï¼Œé™¤éå¿…è¦

#### 3. ç»´æŠ¤åŸåˆ™
- ä¿æŒæ ·å¼çš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§
- å®šæœŸæ£€æŸ¥å’Œæ¸…ç†é‡å¤çš„æ ·å¼ä»£ç 
- ç¡®ä¿æ–°å¢åŠŸèƒ½éµå¾ªç°æœ‰çš„è®¾è®¡è§„èŒƒ

### æ–‡ä»¶ç»“æ„
```
src/renderer/src/styles/
â”œâ”€â”€ antd-theme.css          # Modal åŸºç¡€æ ·å¼å’Œå˜ä½“
â”œâ”€â”€ components.css          # å…¶ä»–ç»„ä»¶æ ·å¼
â””â”€â”€ global.css             # å…¨å±€æ ·å¼

src/renderer/src/components/
â””â”€â”€ [ComponentName]/
    â”œâ”€â”€ ComponentName.tsx
    â””â”€â”€ ComponentName.module.css  # ç»„ä»¶ç‰¹æœ‰æ ·å¼
```

### æ³¨æ„äº‹é¡¹
1. ä¿®æ”¹ Modal åŸºç¡€æ ·å¼æ—¶è¦è€ƒè™‘å¯¹æ‰€æœ‰ Modal çš„å½±å“
2. æ–°å¢å˜ä½“æ ·å¼æ—¶è¦ç¡®ä¿ä¸ç°æœ‰è®¾è®¡é£æ ¼ä¸€è‡´
3. æµ‹è¯•ä¸åŒå±å¹•å°ºå¯¸ä¸‹çš„æ˜¾ç¤ºæ•ˆæœ
4. ä¿æŒä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§

## React Context æœ€ä½³å®è·µ

### ä¸‰æ–‡ä»¶åˆ†ç¦»æ¨¡å¼

ä¸ºäº†é¿å…æ€§èƒ½é—®é¢˜å’Œå¾ªç¯ä¾èµ–ï¼Œæˆ‘ä»¬é‡‡ç”¨ä¸‰æ–‡ä»¶åˆ†ç¦»çš„ Context ç»„ç»‡æ¨¡å¼ï¼š

#### 1. ç±»å‹å®šä¹‰æ–‡ä»¶ (`*-context.ts`)
```typescript
// src/renderer/src/contexts/subtitle-list-context.ts
import { createContext } from 'react'
import type { SubtitleItem } from '@types_/shared'

export interface SubtitleListContextType {
  // çŠ¶æ€
  subtitles: SubtitleItem[]
  showSubtitles: boolean
  currentSubtitleIndex: number
  
  // æ“ä½œæ–¹æ³•
  handleSubtitleUpload: (file: File) => boolean
  toggleSubtitles: () => void
  getCurrentSubtitleIndex: (currentTime: number) => number
  getCurrentSubtitle: (currentTime: number) => SubtitleItem | null
  setAutoScrollEnabled: (enabled: boolean) => void
  setCurrentSubtitleIndex: (index: number) => void
  restoreSubtitles: (subtitles: SubtitleItem[], currentSubtitleIndex: number) => void
}

export const SubtitleListContext = createContext<SubtitleListContextType | null>(null)
```

#### 2. Provider ç»„ä»¶æ–‡ä»¶ (`*Context.tsx`)
```typescript
// src/renderer/src/contexts/SubtitleListContext.tsx
import React from 'react'
import { useSubtitleList } from '../hooks/useSubtitleList'
import { SubtitleListContext, type SubtitleListContextType } from './subtitle-list-context'

export function SubtitleListProvider({
  children
}: {
  children: React.ReactNode
}): React.JSX.Element {
  const value: SubtitleListContextType = useSubtitleList()

  return <SubtitleListContext.Provider value={value}>{children}</SubtitleListContext.Provider>
}
```

#### 3. è‡ªå®šä¹‰ Hook æ–‡ä»¶ (`use*Context.ts`)
```typescript
// src/renderer/src/hooks/useSubtitleListContext.ts
import { useContext } from 'react'
import {
  SubtitleListContext,
  type SubtitleListContextType
} from '../contexts/subtitle-list-context'

export function useSubtitleListContext(): SubtitleListContextType {
  const context = useContext(SubtitleListContext)
  if (!context) {
    throw new Error('useSubtitleListContext å¿…é¡»åœ¨ SubtitleListProvider å†…éƒ¨ä½¿ç”¨')
  }

  return context
}
```

### Context æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 1. é¿å…å±è”½è·å– (Prop Drilling)
- ä½¿ç”¨ Context ç›´æ¥åœ¨éœ€è¦çš„ç»„ä»¶ä¸­è·å–çŠ¶æ€
- å‡å°‘ä¸å¿…è¦çš„ props ä¼ é€’
- æé«˜ç»„ä»¶çš„å¯ç»´æŠ¤æ€§

#### 2. åˆç†çš„ Provider å±‚çº§
```typescript
// App.tsx - Provider åµŒå¥—ç»“æ„
<PlaybackSettingsProvider>
  <ShortcutProvider>
    <PlayingVideoProvider>
      <SubtitleListProvider>
        {/* åº”ç”¨å†…å®¹ */}
      </SubtitleListProvider>
    </PlayingVideoProvider>
  </ShortcutProvider>
</PlaybackSettingsProvider>
```

#### 3. Hook å†…éƒ¨ä½¿ç”¨ Context
```typescript
// ä¼˜åŒ–å‰ï¼šé€šè¿‡å‚æ•°ä¼ é€’
const subtitleControl = useSubtitleControl({
  subtitlesLength: subtitles.length,
  getSubtitle: (index) => subtitles[index],
  getAllSubtitles: () => subtitles,
  // ... å…¶ä»–å‚æ•°
})

// ä¼˜åŒ–åï¼šHook å†…éƒ¨ä½¿ç”¨ Context
const subtitleControl = useSubtitleControl({
  currentSubtitleIndex,
  currentTime,
  isPlaying,
  isVideoLoaded,
  onSeek,
  onPause
})

// Hook å†…éƒ¨
export function useSubtitleControl(params) {
  const { subtitles } = useSubtitleListContext()
  // ç›´æ¥ä½¿ç”¨ context ä¸­çš„æ•°æ®
}
```

### ç»„ä»¶ä¼˜åŒ–ç¤ºä¾‹

#### ä¼˜åŒ–å‰ï¼šé€šè¿‡ Props ä¼ é€’
```typescript
// SidebarSection æ¥æ”¶ subtitles ä½œä¸º prop
<SidebarSection
  subtitles={subtitleList.subtitles}
  // ... å…¶ä»– props
/>
```

#### ä¼˜åŒ–åï¼šç›´æ¥ä½¿ç”¨ Context
```typescript
// SidebarSection å†…éƒ¨ä½¿ç”¨ context
export function SidebarSection(props) {
  const { subtitles } = useSubtitleListContext()
  // ç›´æ¥ä½¿ç”¨ context ä¸­çš„æ•°æ®
}

// è°ƒç”¨æ—¶ä¸éœ€è¦ä¼ é€’ subtitles
<SidebarSection
  // ... å…¶ä»– propsï¼ˆä¸åŒ…æ‹¬ subtitlesï¼‰
/>
```

### æœ€ä½³å®è·µæ€»ç»“

1. **ä¸‰æ–‡ä»¶åˆ†ç¦»**ï¼šç±»å‹å®šä¹‰ã€Provider ç»„ä»¶ã€è‡ªå®šä¹‰ Hook åˆ†åˆ«æ”¾åœ¨ä¸åŒæ–‡ä»¶
2. **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨ TypeScript ç¡®ä¿ Context ç±»å‹å®‰å…¨
3. **é”™è¯¯å¤„ç†**ï¼šåœ¨è‡ªå®šä¹‰ Hook ä¸­æ£€æŸ¥ Context æ˜¯å¦å­˜åœ¨
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šè®© Hook ç›´æ¥ä½¿ç”¨ Contextï¼Œå‡å°‘å‚æ•°ä¼ é€’
5. **ç»„ä»¶è§£è€¦**ï¼šç»„ä»¶ç›´æ¥ä½¿ç”¨ Contextï¼Œå‡å°‘ props ä¾èµ–

### å‘½åè§„èŒƒ

- Context ç±»å‹ï¼š`*ContextType`
- Context å®ä¾‹ï¼š`*Context`
- Provider ç»„ä»¶ï¼š`*Provider`
- è‡ªå®šä¹‰ Hookï¼š`use*Context`

è¿™ç§æ¨¡å¼ç¡®ä¿äº†ä»£ç çš„å¯ç»´æŠ¤æ€§ã€æ€§èƒ½å’Œç±»å‹å®‰å…¨ã€‚

## æ€§èƒ½ä¼˜åŒ–ï¼šè§£å†³ PlayPage é¢‘ç¹é‡æ–°æ¸²æŸ“é—®é¢˜

### ğŸš¨ é—®é¢˜æè¿°

åœ¨æ’­æ”¾è§†é¢‘æ—¶ï¼ŒPlayPage ç»„ä»¶å‡ºç°é¢‘ç¹é‡æ–°æ¸²æŸ“çš„ä¸¥é‡æ€§èƒ½é—®é¢˜ï¼Œå¯¼è‡´ï¼š
- æ¯ç§’å¤šæ¬¡é‡æ–°æ¸²æŸ“
- è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ä¸ç¨³å®š
- ç”¨æˆ·ç•Œé¢å¡é¡¿
- èµ„æºæ¶ˆè€—è¿‡é«˜

### ğŸ” æ ¹æœ¬åŸå› åˆ†æ

1. **usePlayStateSaver ä½¿ç”¨äº† useVideoTime()**
   - `useVideoTime()` è®¢é˜…è§†é¢‘æ—¶é—´å˜åŒ–
   - æ¯å½“è§†é¢‘æ’­æ”¾æ—¶é—´æ›´æ–°æ—¶éƒ½ä¼šè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“
   - è¿™æ˜¯å¯¼è‡´é¢‘ç¹é‡æ–°æ¸²æŸ“çš„ä¸»è¦åŸå› 

2. **usePlayStateInitializer ä¾èµ–è¿‡äºå¹¿æ³›**
   - ä¾èµ–æ•°ç»„åŒ…å«æ•´ä¸ª context å¯¹è±¡
   - Context å¯¹è±¡çš„ä»»ä½•å˜åŒ–éƒ½ä¼šå¯¼è‡´é‡æ–°è¿è¡Œ

3. **React.memo ä½¿ç”¨ä¸å½“**
   - ç¼ºå°‘ç²¾ç¡®çš„æ¯”è¾ƒå‡½æ•°
   - æ— æ³•æœ‰æ•ˆé˜»æ­¢ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“

### âœ… è§£å†³æ–¹æ¡ˆ

#### 1. **ä¼˜åŒ– usePlayStateSaver Hook**

**ğŸ”§ å…³é”®æ”¹è¿›ï¼šä½¿ç”¨ ref è€Œä¸æ˜¯çŠ¶æ€è®¢é˜…**

```typescript
// âŒ é”™è¯¯æ–¹å¼ï¼šä¼šå¯¼è‡´é‡æ–°æ¸²æŸ“
const currentTime = useVideoTime()
const duration = useVideoDuration()

// âœ… æ­£ç¡®æ–¹å¼ï¼šä½¿ç”¨ refï¼Œä¸ä¼šé‡æ–°æ¸²æŸ“
const currentTimeRef = useVideoTimeRef()
const { durationRef } = useVideoStateRefs()

// åœ¨éœ€è¦æ—¶ä» ref è¯»å–å€¼
const currentTime = currentTimeRef.current
const duration = durationRef.current
```

**ğŸ¯ æ•ˆæœï¼š** å®Œå…¨æ¶ˆé™¤äº†è‡ªåŠ¨ä¿å­˜å¯¼è‡´çš„é‡æ–°æ¸²æŸ“

#### 2. **ä¼˜åŒ– usePlayStateInitializer Hook**

**ğŸ”§ å…³é”®æ”¹è¿›ï¼šå‡å°‘ä¾èµ–æ•°ç»„ï¼Œä½¿ç”¨ç¨³å®šçš„ ref**

```typescript
// âŒ é”™è¯¯æ–¹å¼ï¼šä¾èµ–è¿‡å¤š
useEffect(() => {
  // ...
}, [playingVideoContext, subtitleListContext, savePlayStateRef, restoreVideoState])

// âœ… æ­£ç¡®æ–¹å¼ï¼šåªç›‘å¬å¿…è¦çš„ä¾èµ–
useEffect(() => {
  // ...
}, [
  playingVideoContext.originalFilePath,
  playingVideoContext.videoFile
])
```

#### 3. **ä¼˜åŒ– PlayPage ç»„ä»¶**

**ğŸ”§ å…³é”®æ”¹è¿›ï¼šç²¾ç¡®çš„ React.memo æ¯”è¾ƒ**

```typescript
// âœ… è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°
const PlayPageMemo = React.memo<PlayPageProps>(
  function PlayPage({ onBack }) {
    // ç»„ä»¶é€»è¾‘
  },
  (prevProps, nextProps) => {
    // ğŸ¯ ç²¾ç¡®æ¯”è¾ƒï¼šåªæœ‰å½“ onBack å‡½æ•°çœŸæ­£æ”¹å˜æ—¶æ‰é‡æ–°æ¸²æŸ“
    return prevProps.onBack === nextProps.onBack
  }
)
```

### ğŸ“‹ æœ€ä½³å®è·µæŒ‡å—

#### 1. **Hook è®¾è®¡åŸåˆ™**

- **ä½¿ç”¨ ref è€Œä¸æ˜¯çŠ¶æ€è®¢é˜…**ï¼šå¯¹äºé¢‘ç¹æ›´æ–°ä½†ä¸éœ€è¦è§¦å‘é‡æ–°æ¸²æŸ“çš„æ•°æ®
- **ç²¾ç¡®çš„ä¾èµ–æ•°ç»„**ï¼šåªåŒ…å«çœŸæ­£éœ€è¦ç›‘å¬çš„å€¼
- **ç¨³å®šçš„å‡½æ•°å¼•ç”¨**ï¼šä½¿ç”¨ `useCallback` ç¼“å­˜å‡½æ•°

#### 2. **ç»„ä»¶ä¼˜åŒ–åŸåˆ™**

- **React.memo + è‡ªå®šä¹‰æ¯”è¾ƒ**ï¼šç²¾ç¡®æ§åˆ¶é‡æ–°æ¸²æŸ“æ¡ä»¶
- **useMemo ç¼“å­˜å¤æ‚å¯¹è±¡**ï¼šé¿å…æ¯æ¬¡æ¸²æŸ“æ—¶é‡æ–°åˆ›å»ºå¯¹è±¡
- **useCallback ç¼“å­˜äº‹ä»¶å¤„ç†å‡½æ•°**ï¼šä¿æŒå¼•ç”¨ç¨³å®š

#### 3. **æ€§èƒ½ç›‘æ§**

```typescript
// å¼€å‘æ¨¡å¼ä¸‹çš„æ€§èƒ½ç›‘æ§
if (process.env.NODE_ENV === 'development') {
  console.log('ğŸ¬ PlayPage æ¸²æŸ“ - ', new Date().toLocaleTimeString())
}
```

### ğŸš€ ä¼˜åŒ–æ•ˆæœ

#### æ€§èƒ½æå‡å¯¹æ¯”

| ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|--------|--------|
| æ¯ç§’ 3-5 æ¬¡é‡æ–°æ¸²æŸ“ | åŸºæœ¬æ— é‡æ–°æ¸²æŸ“ |
| è‡ªåŠ¨ä¿å­˜ä¸ç¨³å®š | è‡ªåŠ¨ä¿å­˜ç¨³å®šè¿è¡Œ |
| ç•Œé¢å¡é¡¿ | æµç•…è¿è¡Œ |
| CPU å ç”¨é«˜ | CPU å ç”¨æ­£å¸¸ |

#### å…³é”®ç‰¹æ€§

âœ… **è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ç¨³å®šè¿è¡Œ** - ä¸ä¼šè¢«é‡æ–°æ¸²æŸ“å½±å“  
âœ… **æ’­æ”¾æ€§èƒ½ä¼˜åŒ–** - æ¶ˆé™¤äº†æ’­æ”¾æ—¶çš„å¡é¡¿  
âœ… **èµ„æºæ¶ˆè€—é™ä½** - å‡å°‘äº†ä¸å¿…è¦çš„è®¡ç®—  
âœ… **ä»£ç å¯ç»´æŠ¤æ€§æå‡** - æ¸…æ™°çš„ä¾èµ–å…³ç³»  

### ğŸ”§ æŠ€æœ¯æ¶æ„

#### Hook è´£ä»»åˆ†ç¦»

```
usePlayStateSaver (è‡ªåŠ¨ä¿å­˜)
â”œâ”€â”€ useVideoTimeRef (refï¼Œä¸è§¦å‘æ¸²æŸ“)
â”œâ”€â”€ useVideoStateRefs (refï¼Œä¸è§¦å‘æ¸²æŸ“)
â””â”€â”€ å®šæ—¶å™¨æœºåˆ¶ (5ç§’é—´éš”)

usePlayStateInitializer (çŠ¶æ€åˆå§‹åŒ–)
â”œâ”€â”€ ç²¾ç¡®ä¾èµ–ç›‘å¬
â”œâ”€â”€ ref ç¼“å­˜å‡½æ•°å¼•ç”¨
â””â”€â”€ é¿å…é‡å¤åˆå§‹åŒ–

PlayPage (ä¸»ç»„ä»¶)
â”œâ”€â”€ React.memo + è‡ªå®šä¹‰æ¯”è¾ƒ
â”œâ”€â”€ useCallback ç¼“å­˜å‡½æ•°
â””â”€â”€ useMemo ç¼“å­˜å¯¹è±¡
```

### ğŸ“– ä»£ç ç¤ºä¾‹

#### é«˜æ€§èƒ½ Hook æ¨¡å¼

```typescript
export function useOptimizedHook() {
  // ğŸ”§ ä½¿ç”¨ ref å­˜å‚¨é¢‘ç¹å˜åŒ–çš„å€¼
  const valueRef = useRef()
  
  // ğŸ”§ ç¼“å­˜å‡½æ•°ï¼Œé¿å…é‡æ–°åˆ›å»º
  const stableFunction = useCallback(() => {
    // ä» ref è¯»å–å€¼ï¼Œä¸è§¦å‘é‡æ–°æ¸²æŸ“
    const currentValue = valueRef.current
    // å¤„ç†é€»è¾‘
  }, []) // ç¨³å®šçš„ä¾èµ–æ•°ç»„
  
  // ğŸ”§ ç²¾ç¡®çš„ useEffect ä¾èµ–
  useEffect(() => {
    // åªç›‘å¬çœŸæ­£éœ€è¦çš„å˜åŒ–
  }, [å¿…è¦çš„ä¾èµ–])
  
  return { stableFunction }
}
```

#### é«˜æ€§èƒ½ç»„ä»¶æ¨¡å¼

```typescript
const OptimizedComponent = React.memo(
  function Component({ onAction }) {
    // ğŸ”§ ç¼“å­˜å¤æ‚è®¡ç®—
    const memoizedValue = useMemo(() => {
      return computeExpensiveValue()
    }, [dependencies])
    
    // ğŸ”§ ç¼“å­˜äº‹ä»¶å¤„ç†å‡½æ•°
    const handleEvent = useCallback(() => {
      onAction()
    }, [onAction])
    
    return <div onClick={handleEvent}>{memoizedValue}</div>
  },
  // ğŸ”§ è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°
  (prevProps, nextProps) => {
    return prevProps.onAction === nextProps.onAction
  }
)
```

### ğŸ” è°ƒè¯•å·¥å…·

#### é‡æ–°æ¸²æŸ“æ£€æµ‹

```typescript
// æ·»åŠ åˆ°ç»„ä»¶ä¸­æ£€æµ‹é‡æ–°æ¸²æŸ“
const renderCount = useRef(0)
renderCount.current++
console.log(`ç»„ä»¶æ¸²æŸ“æ¬¡æ•°: ${renderCount.current}`)
```

#### ä¾èµ–å˜åŒ–ç›‘æ§

```typescript
// ç›‘æ§ useEffect ä¾èµ–å˜åŒ–
useEffect(() => {
  console.log('ä¾èµ–å‘ç”Ÿå˜åŒ–:', { dep1, dep2 })
}, [dep1, dep2])
```

### ğŸ¯ æ ¸å¿ƒåŸåˆ™

1. **é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“** - ä½¿ç”¨ ref å­˜å‚¨é¢‘ç¹å˜åŒ–çš„æ•°æ®
2. **ç²¾ç¡®çš„ä¾èµ–ç®¡ç†** - åªç›‘å¬çœŸæ­£éœ€è¦çš„å˜åŒ–
3. **ç¨³å®šçš„å¼•ç”¨** - ä½¿ç”¨ memo å’Œ callback ä¿æŒå¼•ç”¨ç¨³å®š
4. **æ€§èƒ½ç›‘æ§** - åŠæ—¶å‘ç°å’Œè§£å†³æ€§èƒ½é—®é¢˜

è¿™å¥—è§£å†³æ–¹æ¡ˆç¡®ä¿äº† EchoLab åº”ç”¨åœ¨æ’­æ”¾è§†é¢‘æ—¶çš„é«˜æ€§èƒ½è¿è¡Œï¼Œä¸ºç”¨æˆ·æä¾›æµç•…çš„ä½¿ç”¨ä½“éªŒã€‚
