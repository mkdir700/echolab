<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è§†é¢‘æ’­æ”¾æµ‹è¯•</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #1a1a1a;
        color: white;
      }
      .video-container {
        margin: 20px 0;
        border: 2px dashed #667eea;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
      }
      video {
        width: 100%;
        max-width: 600px;
        height: auto;
        border-radius: 8px;
        background: #000;
      }
      input[type='file'] {
        margin: 10px 0;
        padding: 10px;
        background: #333;
        color: white;
        border: 1px solid #667eea;
        border-radius: 4px;
      }
      .info {
        background: #333;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        font-family: monospace;
        font-size: 14px;
      }
      .error {
        background: #ff4d4f;
        color: white;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }
      .success {
        background: #52c41a;
        color: white;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ¬ è§†é¢‘æ’­æ”¾åŠŸèƒ½æµ‹è¯•</h1>

    <div class="video-container">
      <h3>é€‰æ‹©è§†é¢‘æ–‡ä»¶è¿›è¡Œæµ‹è¯•</h3>
      <input type="file" id="videoInput" accept="video/*" />
      <video id="testVideo" controls style="display: none">æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚</video>
    </div>

    <div id="info" class="info">
      <strong>ç¯å¢ƒä¿¡æ¯ï¼š</strong><br />
      ç”¨æˆ·ä»£ç†: <span id="userAgent"></span><br />
      æ˜¯å¦æ”¯æŒè§†é¢‘: <span id="videoSupport"></span><br />
      æ”¯æŒçš„è§†é¢‘æ ¼å¼: <span id="videoFormats"></span><br />
      Electron ç¯å¢ƒ: <span id="electronEnv"></span>
    </div>

    <div id="messages"></div>

    <script>
      const videoInput = document.getElementById('videoInput')
      const testVideo = document.getElementById('testVideo')
      const messages = document.getElementById('messages')

      // æ˜¾ç¤ºç¯å¢ƒä¿¡æ¯
      document.getElementById('userAgent').textContent = navigator.userAgent
      document.getElementById('videoSupport').textContent =
        !!document.createElement('video').canPlayType
      document.getElementById('electronEnv').textContent =
        typeof window.process !== 'undefined' ? 'æ˜¯' : 'å¦'

      // æ£€æŸ¥æ”¯æŒçš„è§†é¢‘æ ¼å¼
      const video = document.createElement('video')
      const formats = []
      if (video.canPlayType('video/mp4')) formats.push('MP4')
      if (video.canPlayType('video/webm')) formats.push('WebM')
      if (video.canPlayType('video/ogg')) formats.push('OGG')
      if (video.canPlayType('video/avi')) formats.push('AVI')
      document.getElementById('videoFormats').textContent = formats.join(', ') || 'æ— '

      function showMessage(message, type = 'info') {
        const div = document.createElement('div')
        div.className = type
        div.textContent = message
        messages.appendChild(div)
        setTimeout(() => div.remove(), 5000)
      }

      videoInput.addEventListener('change', function (e) {
        const file = e.target.files[0]
        if (!file) return

        showMessage(
          `é€‰æ‹©äº†æ–‡ä»¶: ${file.name} (${file.type}, ${(file.size / 1024 / 1024).toFixed(2)}MB)`,
          'info'
        )

        // åˆ›å»ºå¯¹è±¡ URL
        const url = URL.createObjectURL(file)
        testVideo.src = url
        testVideo.style.display = 'block'

        // ç›‘å¬è§†é¢‘äº‹ä»¶
        testVideo.onloadstart = () => showMessage('å¼€å§‹åŠ è½½è§†é¢‘...', 'info')
        testVideo.oncanplay = () => showMessage('è§†é¢‘å¯ä»¥æ’­æ”¾äº†ï¼', 'success')
        testVideo.onloadedmetadata = () => {
          showMessage(
            `è§†é¢‘å…ƒæ•°æ®å·²åŠ è½½ - æ—¶é•¿: ${testVideo.duration.toFixed(2)}ç§’, å°ºå¯¸: ${testVideo.videoWidth}x${testVideo.videoHeight}`,
            'success'
          )
        }
        testVideo.onerror = (e) => {
          console.error('Video error:', e)
          showMessage(
            `è§†é¢‘åŠ è½½å¤±è´¥: ${testVideo.error ? testVideo.error.message : 'æœªçŸ¥é”™è¯¯'}`,
            'error'
          )
        }

        // æ¸…ç†ä¹‹å‰çš„ URL
        testVideo.onended = () => URL.revokeObjectURL(url)
      })
    </script>
  </body>
</html>
